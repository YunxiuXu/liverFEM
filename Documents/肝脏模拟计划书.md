# 研究计划：基于分组共旋有限元的高保真肝脏手术实时仿真
## 完整执行方案（2024 修订版）

---

## 📋 论文定位

**题目（暂定）**：
- **中文**：面向虚拟手术的各向异性肝脏实时仿真：一种基于 CPU 的分组有限元方法
- **英文**：Real-Time Simulation of Anisotropic Liver Deformation using Group-Based Corotational FEM on Multi-Core CPUs

**核心特性（Key Features）**：
1.  **CPU 上的实时性**：在消费级 CPU 上实现 20k 四面体肝脏模型的 60 FPS 仿真，无需 GPU，降低硬件要求。
2.  **更好的精度（Better Accuracy）**：通过分组策略保留物理特性，在大变形下的精度优于传统的 XPBD 方法。
3.  **复杂本构支持**：支持各向异性（Anisotropy）和近不可压缩（Incompressibility, ν→0.5）材料，解决现有实时方法在这些医疗特性上的不足。

**投稿目标**：
- 中等偏上会议/期刊（如 MICCAI, CASA, CMBBE, CGI 等）
- 周期：3-6 个月

---

## 📅 第一阶段：代码准备 ✅ **已完成**

**状态**：所有必要的代码功能已就绪（各向异性切换、力录制、自动化测试）。可以直接进入实验阶段。

---

## 📅 第二阶段：实验数据采集（1-2 周）

**目标**：运行四个实验，获取数据（表格、曲线、截图）。

---

### 🔬 实验 1：大变形下的精度验证（Accuracy under Large Deformation）

**目的**：证明在手术牵拉（大变形）场景下，GB-cFEM 的形变结果比 XPBD 更接近物理真实（Ground Truth）。

**为什么只做重力不够？**
重力产生的形变较小，线性 FEM 和 XPBD 都能做得不错。**差异在于大变形**。手术中常见的操作是器械牵拉肝脏边缘，产生巨大的非线性形变。XPBD 在此情况下常出现刚度不准或迭代不足导致的人工伪影。

**操作步骤**：
1.  **场景设置**：
    - 固定肝门区域（`fixRegion`）。
    - **施加牵拉力**：选择肝脏边缘的一个节点，施加一个较大的恒定拉力（例如 5N，沿 X 轴），模拟手术钳牵拉。
2.  **运行三种方法**：
    - **GB-cFEM（本文方法）**：记录平衡状态。
    - **XPBD（对比方法）**：设置相同的杨氏模量，运行相同步数（或直到收敛）。
    - **VegaFEM（Ground Truth）**：使用离线非线性 FEM 求解器计算同一受力下的标准结果。
3.  **数据采集**：
    - 计算节点位置的均方根误差（RMSE）对比 Ground Truth。
    - 截图：将三种方法的网格重叠显示（Outline 模式）。GB-cFEM 应与 VegaFEM 轮廓更为重合，而 XPBD 可能会有明显的"过度拉伸"或"体积塌陷"。

**产出**：
- **Table 1**：大变形下的 RMSE 对比。
- **Figure 3**：牵拉状态下的网格重叠图。直观展示你的方法更贴合 Ground Truth。

---

### 🔬 实验 2：不可压缩稳定性（Volume Preservation）

**目的**：证明在 ν→0.5（模拟充血组织）时，本方法能保持体积，而 XPBD 容易出现体积丢失。

**操作步骤**：
1.  **参数设置**：
    - `parameters.txt` 中 `poisson=0.49`。
2.  **实验流程**：
    - 鼠标大幅度拉伸/按压肝脏。
    - 每帧计算并记录总体积变化率：$\Delta V / V_0$。
3.  **对比**：
    - 对比 XPBD 在相同泊松比下的体积变化（XPBD 通常难以严格满足体积约束，除非增加昂贵的约束求解）。

**产出**：
- **Figure 4**：体积变化曲线图。你的曲线应平稳在 0 附近，对手曲线可能有较大波动。

---

### 🔬 实验 3：各向异性本构验证（Anisotropic Validation）

**目的**：**验证**算法能否正确响应各向异性的物理参数设置，并对比 XPBD 难以精确映射物理参数的劣势。这不是为了发现"横竖拉不一样"的现象，而是为了证明方法在**物理准确性（Physical Accuracy）**上的优势。

**为什么这个实验很重要？**
现有实时方法（如 XPBD）难以将医学测量的各向异性参数（如 $E_x, E_y$）直接映射到其约束刚度中，通常只能通过试错法（Tuning）来模拟。而本 FEM 方法直接基于物理本构。证明这一点是实现**患者特异性（Patient-Specific）**手术模拟的前提——即未来可以直接导入 DTI 医学影像数据来驱动模拟。

**操作步骤**：
1.  **参数设置**：
    - 设置 $E_x = 5E_y$（模拟沿 X 轴的纤维增强）。
2.  **实验流程**：
    - 沿 X 轴（硬轴）拖拽一定距离，记录反力。
    - 沿 Y 轴（软轴）拖拽相同距离，记录反力。
3.  **数据处理**：
    - 生成力-位移曲线，计算刚度比值。

**产出**：
- **Figure 5**：两条斜率明显不同的力-位移曲线。
- **结论**：定量数据显示硬轴/软轴刚度比约为 3.4 倍（在 $E_x/E_y=5$ 的输入下），证明求解器能正确反映物理参数输入。相比于参数调节困难的 XPBD，本方法能提供更**准确（Accurate）**的生物力学响应。

---

### 🔬 实验 4：性能分析（Performance）

**目的**：证明 CPU 方案的实时性。

**操作步骤**：
1.  测试不同网格规模（5k, 20k, 50k 四面体）下的 FPS。
2.  记录不同 CPU 线程数（1, 4, 8）下的加速比。

**产出**：
- **Table 2**：FPS 性能表。

---

## 📅 第三阶段：论文撰写（2 周）

### Section 1: Introduction
- **背景**：手术模拟需要实时且物理真实。
- **问题**：现有方法要么慢（传统 FEM），要么物理不准（PBD/XPBD 在各向异性和体积守恒上的缺陷）。GPU 方案成本高。
- **贡献**：
    1.  提出基于分组的 CPU 并行 FEM 框架。
    2.  集成各向异性本构，提高医疗仿真的物理逼真度。
    3.  验证了在大变形和近不可压缩情况下的稳定性。

### Section 2: Methodology
- **Group-Based Acceleration**：解释如何通过分组减少数据竞争，利用 CPU 多核。
- **Anisotropic Constitutive Model**：列出各向异性刚度矩阵的公式。
- **Implicit Integration**：简述求解过程。

### Section 3: Experiments and Results
- **3.1 Setup**：实验平台与参数。
- **3.2 Accuracy**：展示实验 1 结果（牵拉实验）。强调在大变形下比 XPBD 更准。
- **3.3 Stability**：展示实验 2 结果（体积守恒）。
- **3.4 Anisotropy**：展示实验 3 结果（力反馈差异）。
- **3.5 Performance**：展示实验 4 结果（FPS）。

### Section 4: Discussion & Conclusion
- **总结**：该方法提供了一个**平衡的（Balanced）**解决方案：在 CPU 上实现了足够的实时性，同时保留了必要的物理精度。
- **局限**：未处理拓扑改变（切割）。
- **未来工作**：结合医学影像（DTI）数据导入真实纤维方向。

---

## 🚀 当前任务清单

1.  **[实验 3] 各向异性测试**（最快）：
    - 运行程序，分别在各向异性和同性参数下，用 `X`/`Y` 键自动测试并保存数据。
    - 用 Python 画图。
2.  **[实验 2] 体积守恒测试**：
    - 设 `poisson=0.49`，手动大变形拖拽，观察是否稳定。
3.  **[实验 1] 精度测试**（需要花点时间）：
    - 思考如何获取 Ground Truth 数据（是否有 VegaFEM 安装？或者引用标准数据？）。如果没有 VegaFEM，可以考虑用高分辨率的离线 FEM 结果作为参考。
