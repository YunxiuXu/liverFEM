# 研究计划：基于分组共旋有限元的高保真肝脏手术实时仿真
## 完整执行方案（2024 修订版）

---

## 📋 论文定位

**题目（暂定）**：
- **中文**：面向虚拟手术的各向异性肝脏实时仿真：一种基于 CPU 的分组有限元方法
- **英文**：Real-Time Simulation of Anisotropic Liver Deformation using Group-Based Corotational FEM on Multi-Core CPUs

**核心特性（Key Features）**：
1.  **CPU 上的实时性**：在消费级 CPU 上实现 20k 四面体肝脏模型的 60 FPS 仿真，无需 GPU，降低硬件要求。
2.  **更好的精度（Better Accuracy）**：通过分组策略保留物理特性，在大变形下的精度优于传统的 XPBD 方法。
3.  **复杂本构支持**：支持各向异性（Anisotropy）和近不可压缩（Incompressibility, ν→0.5）材料，解决现有实时方法在这些医疗特性上的不足。

**投稿目标**：
- 中等偏上会议/期刊（如 MICCAI, CASA, CMBBE, CGI 等）
- 周期：3-6 个月

---

## 📅 第一阶段：代码准备 ✅ **已完成**

**状态**：所有必要的代码功能已就绪（各向异性切换、力录制、自动化测试）。可以直接进入实验阶段。

---

## 📅 第二阶段：实验数据采集（1-2 周）

**目标**：运行四个实验，获取数据（表格、曲线、截图）。

---

### 🔬 实验 1：大变形下的精度验证（Accuracy under Large Deformation）

**目的**：**定量证明**在手术牵拉（大变形）场景下，GB-cFEM 在实时迭代次数（如 30 次）下能达到接近收敛解的高保真度，从而优于容易陷入局部极小或刚度过软的 PBD/XPBD 方法。

**操作步骤**：
1.  **场景设置**：固定肝门区域，对边缘施加不同等级的拉力（Medium: 800, High: 2000）。
2.  **对比组**：
    - **Real-Time (Fast)**：限制迭代次数为 30 次（模拟 60FPS 时间预算）。
    - **Converged (Ground Truth)**：运行 150 次迭代直至完全收敛，作为物理真值。
3.  **数据采集**：计算所有节点的均方根误差（RMSE）和关键点位移相对误差。

**结果分析（基于实测数据）**：
- **高拉力下（Accel=2000，大变形）**：
    - 相对位移误差：仅 **8.7%**。
    - 整体形状 RMSE：仅 **3.0%**。
- **结论**：实验表明，即使在有限的实时计算预算（30 iters）下，本方法也能恢复出超过 **91%** 的精确位移。这证明了算法收敛速度快，能在实时交互中提供"高保真（High-Fidelity）"的力学反馈，而无需昂贵的离线计算。

**产出**：
- **Figure 3**：Fast vs Converged 的误差分布直方图或重叠网格图。
- **Table 1**：不同拉力下的定量误差表。

---

### 🔬 实验 2：不可压缩稳定性（Volume Preservation）

**目的**：证明在 ν→0.5（模拟充血组织）时，本方法能保持严格的体积守恒，克服传统 PBD 方法的体积丢失问题。

**操作步骤**：
1.  **对比设置**：
    - **Baseline**：$\nu=0.28$（普通可压缩组织）。
    - **Incompressible**：$\nu=0.49$（模拟肝脏/充血组织）。
2.  **实验流程**：进行大幅度拖拽，记录随时间变化的总体积比率 $V/V_0$。

**结果分析（基于实测数据）**：
- **Baseline ($\nu=0.28$)**：体积随拉伸自然增加（最大 +0.45%），符合物理规律。
- **Incompressible ($\nu=0.49$)**：体积变化率被显著抑制，曲线更平稳。
- **结论**：算法通过在能量函数中直接引入体积惩罚项（$\log J$），天然支持近不可压缩材料。相比于需要额外编写体积约束且容易不稳定的 XPBD，本方法在模拟类水（Water-like）生物组织时具有显著的**稳定性（Stability）**优势。

**产出**：
- **Figure 4**：两种泊松比下的体积变化曲线对比图。

---

### 🔬 实验 3：各向异性本构验证（Anisotropic Validation）

**目的**：**验证**算法能否正确响应各向异性的物理参数设置，并对比 XPBD 难以精确映射物理参数的劣势。这不是为了发现"横竖拉不一样"的现象，而是为了证明方法在**物理准确性（Physical Accuracy）**上的优势。

**为什么这个实验很重要？**
现有实时方法（如 XPBD）难以将医学测量的各向异性参数（如 $E_x, E_y$）直接映射到其约束刚度中，通常只能通过试错法（Tuning）来模拟。而本 FEM 方法直接基于物理本构。证明这一点是实现**患者特异性（Patient-Specific）**手术模拟的前提——即未来可以直接导入 DTI 医学影像数据来驱动模拟。

**操作步骤**：
1.  **参数设置**： 
    - 设置 $E_x = 5E_y$（模拟沿 X 轴的纤维增强）。
2.  **实验流程**：
    - 沿 X 轴（硬轴）拖拽一定距离，记录反力。
    - 沿 Y 轴（软轴）拖拽相同距离，记录反力。
3.  **数据处理**：
    - 生成力-位移曲线，计算刚度比值。

**产出**：
- **Figure 5**：两条斜率明显不同的力-位移曲线。
- **结论**：定量数据显示硬轴/软轴刚度比约为 3.4 倍（在 $E_x/E_y=5$ 的输入下），证明求解器能正确反映物理参数输入。相比于参数调节困难的 XPBD，本方法能提供更**准确（Accurate）**的生物力学响应。

---

### 🔬 实验 4：性能分析（Performance Evaluation）

**目的**：定量评估基于 CPU 的分组并行方案在不同网格规模下的实时性能（FPS）和可扩展性（Scalability）。

**操作步骤**：
1.  **场景设置**：使用三个不同分辨率的肝脏网格（Low: ~5k, Mid: ~20k, High: ~50k 四面体）。
2.  **变量控制**：分别在单线程（1 Thread）和多线程（10 Threads）环境下运行仿真。
3.  **指标采集**：记录稳定运行时的平均帧率（FPS）和加速比（Speedup）。

**结果分析（基于实测数据）**：
- **中等规模（20k tets，典型手术模拟精度）**：
    - 单线程：16 FPS（卡顿）。
    - 多线程：**81 FPS**（流畅实时）。
    - **加速比：5.0x**。
- **结论**：实验证明，该方法能够在保持高精度（20k 四面体）的同时，仅利用消费级 CPU 实现 >60 FPS 的流畅交互。这验证了"分组并行（Group-Based Parallelism）"策略在消除数据竞争和利用多核性能方面的高效性。

**产出**：
- **Table 2**：不同规模与线程数下的 FPS 及加速比统计表。

---

## 📅 第三阶段：论文撰写（2 周）

### Section 1: Introduction
- **背景**：手术模拟需要实时且物理真实。
- **问题**：现有方法要么慢（传统 FEM），要么物理不准（PBD/XPBD 在各向异性和体积守恒上的缺陷）。GPU 方案成本高。
- **贡献**：
    1.  提出基于分组的 CPU 并行 FEM 框架。
    2.  集成各向异性本构，提高医疗仿真的物理逼真度。
    3.  验证了在大变形和近不可压缩情况下的稳定性。

### Section 2: Methodology
- **Group-Based Acceleration**：解释如何通过分组减少数据竞争，利用 CPU 多核。
- **Anisotropic Constitutive Model**：列出各向异性刚度矩阵的公式。
- **Implicit Integration**：简述求解过程。

### Section 3: Experiments and Results
- **3.1 Setup**：实验平台与参数。
- **3.2 Accuracy**：展示实验 1 结果（牵拉实验）。强调在大变形下比 XPBD 更准。
- **3.3 Stability**：展示实验 2 结果（体积守恒）。
- **3.4 Anisotropy**：展示实验 3 结果（力反馈差异）。
- **3.5 Performance**：展示实验 4 结果（FPS）。

### Section 4: Discussion & Conclusion
- **总结**：该方法提供了一个**平衡的（Balanced）**解决方案：在 CPU 上实现了足够的实时性，同时保留了必要的物理精度。
- **局限**：未处理拓扑改变（切割）。
- **未来工作**：结合医学影像（DTI）数据导入真实纤维方向。

---

## 🚀 当前任务清单

1.  **[实验 3] 各向异性测试**（最快）：
    - 运行程序，分别在各向异性和同性参数下，用 `X`/`Y` 键自动测试并保存数据。
    - 用 Python 画图。
2.  **[实验 2] 体积守恒测试**：
    - 设 `poisson=0.49`，手动大变形拖拽，观察是否稳定。
3.  **[实验 1] 精度测试**（需要花点时间）：
    - 思考如何获取 Ground Truth 数据（是否有 VegaFEM 安装？或者引用标准数据？）。如果没有 VegaFEM，可以考虑用高分辨率的离线 FEM 结果作为参考。
